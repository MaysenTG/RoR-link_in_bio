<div class="d-flex text-center w-100 justify-content-center align-items-center">
  <h1 class="text-center">Editing landingpage</h1>
  &nbsp;
  <a href="/<%= @landingpage.url %>" target="_blank" class="btn btn-primary text-center">Preview</a>
</div>
<section>
  <div class="container p-5 h-100">
    <div class="row d-flex justify-content-center align-items-center h-100">
      <div class="col-md-12 col-xl-4">
        <form data-turbo="false" class="edit_account" id="edit_account" action="/accounts" accept-charset="UTF-8" method="post">
          <div class="card" style="border-radius: 15px;">
            <div class="card-body text-center">
              <div class="mt-3 mb-4">
                <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava2-bg.webp"
                class="rounded-circle img-fluid" style="width: 100px;" />
              </div>
              <input type="hidden" name="_method" value="put" autocomplete="off">
              <input type="hidden" name="id" value="<%= Account.find(@landingpage.account_id).id %>" >
              <div class="d-flex justify-content-evenly align-items-center">
                <div class="mb-3">
                  <label for="account_name">Name</label><br>
                  <input type="text" value="<%= Account.find(@landingpage.account_id).name %>" name="account[name]" id="account_name">
                </div>
                <div class="actions">
                  <input type="submit" name="commit" class="btn btn-primary" value="Update" data-disable-with="Update">
                </div>
              </div>
              <p class="text-muted">@<%= Account.find(@landingpage.account_id).landingpage_url %> <span class="mx-2">|</span> <a
                href="#!">personalportfoliowebsite.com</a></p>
            </div>
            <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
              <div class="d-flex justify-content-center">
                <div onclick="toggle('facebook');" class="social-media-btn social_facebook btn btn-floating mx-1">
                  <i class="fs-3 bi bi-facebook"></i>
                </div>
                <div onclick="toggle('twitter');" class="social-media-btn social_twitter btn btn-floating mx-1">
                  <i class="fs-3 bi bi-twitter"></i>
                </div>
                <div onclick="toggle('github');" class="social-media-btn social_github btn btn-floating mx-1">
                  <i class="fs-3 bi bi-github"></i>
                </div>
                <div onclick="toggle('linkedin');" class="social-media-btn social_linkedin btn btn-floating mx-1">
                  <i class="fs-3 bi bi-linkedin"></i>
                </div>
              </div>
              <input type="text" value="<%= Account.find(@landingpage.account_id).twitter %>" name="account[twitter]" class="form-control d-none">
              <input type="text" value="<%= Account.find(@landingpage.account_id).github %>" name="account[github]" class="form-control d-none">
              <input type="text" value="<%= Account.find(@landingpage.account_id).facebook %>" name="account[facebook]" class="form-control d-none">
              <input type="text" value="<%= Account.find(@landingpage.account_id).linkedin %>" name="account[linkedin]" class="form-control d-none">
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
</section>
<section class="container">
  <div class="list-group w-auto">
    <% @blocks.each do |block| %>
      <div class="block-container">
        <div class="preview-form-container d-flex">
          <div class="list-group-item list-group-item-action d-flex gap-3 py-3" aria-current="true">
            <img src="https://github.com/twbs.png" alt="twbs" width="32" height="32" class="rounded-circle flex-shrink-0"/>
            <div class="d-flex gap-2 w-100 justify-content-between">
              <div>
                <h6 class="mb-0"><%= block.title %></h6>
                <p class="mb-0 opacity-75"><%= block.content %></p>
              </div>
              <small onClick="showEditBlock(this);" class="opacity-50 text-nowrap"><button class="btn"><i class="fs-2 bi bi-pencil-square"></i></button></small>
            </div>
          </div>
        </div>
        <div class="d-none edit-form-container">
          <%= render "blocks/form", block: block %>
        </div>
      </div>
    <% end %>
  </div>
  <br/>
  <div class="add-block-container">
    <div class="list-group w-auto">
    </div>
  </div>
  <br/>
  <button class="btn btn-primary w-100" onclick="showAddBlock(this);">Add block</button>
</section>
<script>
  function showAddBlock(e) {
    // Append the new block form to the landingpage
    e.parentElement.querySelector(".add-block-container > .list-group").innerHTML += "<%= escape_javascript(render "blocks/form", block: @new_block) %><br/>";
  }

  function showEditBlock(e) {
    // Hide the preview form
    let preview_form_container = e.closest(".block-container").querySelector(".preview-form-container");
    // Show the edit form
    let edit_form_container = e.closest(".block-container").querySelector(".edit-form-container");

    preview_form_container.classList.add("d-none")
    edit_form_container.classList.remove("d-none")
  }

  function toggle(social_media) {
    let selected_social_media_btn = document.querySelector(`.social_${social_media}`);
    let all_social_media_btns = document.querySelectorAll(`.social-media-btn:not(.social_${social_media})`);
    let social_media_input = document.querySelector(`input[name="account[${social_media}]"]`);

    all_social_media_btns.forEach((btn) => {
      btn.classList.toggle("invisible");
    });
    social_media_input.classList.toggle("d-none");
  }
</script>
